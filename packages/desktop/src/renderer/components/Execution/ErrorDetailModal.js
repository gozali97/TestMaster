"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ErrorDetailModal = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const ErrorDetailModal = ({ error, onClose }) => {
    const [activeTab, setActiveTab] = (0, react_1.useState)('overview');
    // Parse error message to extract useful info
    const parseErrorMessage = (errorMsg) => {
        if (!errorMsg)
            return { type: 'Unknown', message: 'No error message available', details: '' };
        // Common error patterns
        if (errorMsg.includes('timeout') || errorMsg.includes('Timeout')) {
            return {
                type: 'Timeout Error',
                message: 'Element or action timed out',
                details: errorMsg,
                suggestion: 'Increase timeout or check if element exists'
            };
        }
        if (errorMsg.includes('not found') || errorMsg.includes('could not find')) {
            return {
                type: 'Element Not Found',
                message: 'Element could not be located',
                details: errorMsg,
                suggestion: 'Update locator or check if element is present'
            };
        }
        if (errorMsg.includes('navigation') || errorMsg.includes('Navigation')) {
            return {
                type: 'Navigation Error',
                message: 'Page navigation failed',
                details: errorMsg,
                suggestion: 'Check URL or network connection'
            };
        }
        if (errorMsg.includes('click') || errorMsg.includes('Click')) {
            return {
                type: 'Click Failed',
                message: 'Could not click element',
                details: errorMsg,
                suggestion: 'Element might be hidden, disabled, or covered'
            };
        }
        return {
            type: 'General Error',
            message: errorMsg.split('\n')[0],
            details: errorMsg,
            suggestion: 'Review error details for specific issue'
        };
    };
    const parsedError = parseErrorMessage(error.error);
    // Get category badge color
    const getCategoryColor = (category) => {
        switch (category) {
            case 'APP_BUG':
                return 'bg-red-100 text-red-800 border-red-200';
            case 'TEST_ISSUE':
                return 'bg-yellow-100 text-yellow-800 border-yellow-200';
            case 'ENVIRONMENT':
                return 'bg-blue-100 text-blue-800 border-blue-200';
            case 'FLAKY':
                return 'bg-purple-100 text-purple-800 border-purple-200';
            default:
                return 'bg-gray-100 text-gray-800 border-gray-200';
        }
    };
    // Get confidence badge
    const getConfidenceBadge = (confidence) => {
        if (!confidence)
            return null;
        const percentage = Math.round(confidence * 100);
        let color = 'bg-gray-100 text-gray-800';
        if (percentage >= 80)
            color = 'bg-green-100 text-green-800';
        else if (percentage >= 60)
            color = 'bg-yellow-100 text-yellow-800';
        else
            color = 'bg-red-100 text-red-800';
        return ((0, jsx_runtime_1.jsxs)("span", { className: `px-2 py-1 rounded text-xs font-medium ${color}`, children: [percentage, "% confident"] }));
    };
    return ((0, jsx_runtime_1.jsx)("div", { className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4", children: (0, jsx_runtime_1.jsxs)("div", { className: "bg-white rounded-lg shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-hidden", children: [(0, jsx_runtime_1.jsxs)("div", { className: "bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-4 flex items-center justify-between", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-3", children: [(0, jsx_runtime_1.jsx)("div", { className: "bg-white bg-opacity-20 rounded-full p-2", children: (0, jsx_runtime_1.jsx)("svg", { className: "w-6 h-6", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: (0, jsx_runtime_1.jsx)("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" }) }) }), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("h2", { className: "text-xl font-bold", children: "Error Details" }), (0, jsx_runtime_1.jsx)("p", { className: "text-sm text-red-100", children: error.testName })] })] }), (0, jsx_runtime_1.jsx)("button", { onClick: onClose, className: "bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full p-2 transition-all", children: (0, jsx_runtime_1.jsx)("svg", { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: (0, jsx_runtime_1.jsx)("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M6 18L18 6M6 6l12 12" }) }) })] }), (0, jsx_runtime_1.jsx)("div", { className: "border-b border-gray-200 bg-gray-50", children: (0, jsx_runtime_1.jsxs)("div", { className: "flex gap-2 px-6", children: [(0, jsx_runtime_1.jsx)("button", { onClick: () => setActiveTab('overview'), className: `px-4 py-3 font-medium transition-all relative ${activeTab === 'overview'
                                    ? 'text-blue-600 border-b-2 border-blue-600'
                                    : 'text-gray-600 hover:text-gray-900'}`, children: "Overview" }), error.screenshots && error.screenshots.length > 0 && ((0, jsx_runtime_1.jsxs)("button", { onClick: () => setActiveTab('screenshot'), className: `px-4 py-3 font-medium transition-all relative ${activeTab === 'screenshot'
                                    ? 'text-blue-600 border-b-2 border-blue-600'
                                    : 'text-gray-600 hover:text-gray-900'}`, children: ["Screenshots (", error.screenshots.length, ")"] })), error.video && ((0, jsx_runtime_1.jsx)("button", { onClick: () => setActiveTab('video'), className: `px-4 py-3 font-medium transition-all relative ${activeTab === 'video'
                                    ? 'text-blue-600 border-b-2 border-blue-600'
                                    : 'text-gray-600 hover:text-gray-900'}`, children: "Video" })), error.analysis && ((0, jsx_runtime_1.jsxs)("button", { onClick: () => setActiveTab('analysis'), className: `px-4 py-3 font-medium transition-all relative ${activeTab === 'analysis'
                                    ? 'text-blue-600 border-b-2 border-blue-600'
                                    : 'text-gray-600 hover:text-gray-900'}`, children: ["AI Analysis", (0, jsx_runtime_1.jsx)("span", { className: "ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800", children: "Smart" })] }))] }) }), (0, jsx_runtime_1.jsxs)("div", { className: "overflow-y-auto max-h-[calc(90vh-200px)] p-6", children: [activeTab === 'overview' && ((0, jsx_runtime_1.jsxs)("div", { className: "space-y-6", children: [(0, jsx_runtime_1.jsx)("div", { className: "bg-red-50 border border-red-200 rounded-lg p-4", children: (0, jsx_runtime_1.jsxs)("div", { className: "flex items-start gap-3", children: [(0, jsx_runtime_1.jsx)("div", { className: "flex-shrink-0", children: (0, jsx_runtime_1.jsx)("div", { className: "bg-red-100 rounded-full p-2", children: (0, jsx_runtime_1.jsx)("svg", { className: "w-5 h-5 text-red-600", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: (0, jsx_runtime_1.jsx)("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M6 18L18 6M6 6l12 12" }) }) }) }), (0, jsx_runtime_1.jsxs)("div", { className: "flex-1", children: [(0, jsx_runtime_1.jsx)("h3", { className: "text-lg font-semibold text-red-900", children: parsedError.type }), (0, jsx_runtime_1.jsx)("p", { className: "text-red-700 mt-1", children: parsedError.message })] })] }) }), (0, jsx_runtime_1.jsxs)("div", { className: "grid grid-cols-3 gap-4", children: [(0, jsx_runtime_1.jsxs)("div", { className: "bg-gray-50 rounded-lg p-4 border border-gray-200", children: [(0, jsx_runtime_1.jsx)("div", { className: "text-sm text-gray-600 mb-1", children: "Test ID" }), (0, jsx_runtime_1.jsx)("div", { className: "font-mono text-sm text-gray-900", children: error.testId })] }), (0, jsx_runtime_1.jsxs)("div", { className: "bg-gray-50 rounded-lg p-4 border border-gray-200", children: [(0, jsx_runtime_1.jsx)("div", { className: "text-sm text-gray-600 mb-1", children: "Duration" }), (0, jsx_runtime_1.jsxs)("div", { className: "font-semibold text-gray-900", children: [error.duration, "ms"] })] }), (0, jsx_runtime_1.jsxs)("div", { className: "bg-gray-50 rounded-lg p-4 border border-gray-200", children: [(0, jsx_runtime_1.jsx)("div", { className: "text-sm text-gray-600 mb-1", children: "Status" }), (0, jsx_runtime_1.jsx)("span", { className: `inline-flex px-2 py-1 rounded text-xs font-medium ${error.status === 'failed' ? 'bg-red-100 text-red-800' : 'bg-orange-100 text-orange-800'}`, children: error.status.toUpperCase() })] })] }), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsxs)("h4", { className: "text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2", children: [(0, jsx_runtime_1.jsx)("svg", { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: (0, jsx_runtime_1.jsx)("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" }) }), "Error Details"] }), (0, jsx_runtime_1.jsx)("div", { className: "bg-gray-900 text-gray-100 rounded-lg p-4 font-mono text-sm overflow-x-auto", children: (0, jsx_runtime_1.jsx)("pre", { className: "whitespace-pre-wrap", children: parsedError.details || 'No error details available' }) })] }), parsedError.suggestion && ((0, jsx_runtime_1.jsx)("div", { className: "bg-blue-50 border border-blue-200 rounded-lg p-4", children: (0, jsx_runtime_1.jsxs)("div", { className: "flex items-start gap-3", children: [(0, jsx_runtime_1.jsx)("div", { className: "flex-shrink-0", children: (0, jsx_runtime_1.jsx)("svg", { className: "w-5 h-5 text-blue-600", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: (0, jsx_runtime_1.jsx)("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" }) }) }), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("h4", { className: "font-semibold text-blue-900 mb-1", children: "\uD83D\uDCA1 Quick Fix Suggestion" }), (0, jsx_runtime_1.jsx)("p", { className: "text-blue-800", children: parsedError.suggestion })] })] }) }))] })), activeTab === 'screenshot' && error.screenshots && error.screenshots.length > 0 && ((0, jsx_runtime_1.jsxs)("div", { className: "space-y-4", children: [(0, jsx_runtime_1.jsx)("p", { className: "text-sm text-gray-600", children: "Screenshots captured during test execution:" }), error.screenshots.map((screenshot, index) => ((0, jsx_runtime_1.jsxs)("div", { className: "border border-gray-200 rounded-lg overflow-hidden", children: [(0, jsx_runtime_1.jsx)("div", { className: "bg-gray-100 px-4 py-2 border-b border-gray-200", children: (0, jsx_runtime_1.jsxs)("span", { className: "text-sm font-medium text-gray-700", children: ["Screenshot ", index + 1] }) }), (0, jsx_runtime_1.jsx)("div", { className: "p-4 bg-gray-50", children: (0, jsx_runtime_1.jsx)("img", { src: `data:image/png;base64,${screenshot}`, alt: `Screenshot ${index + 1}`, className: "w-full rounded border border-gray-300 shadow-sm" }) })] }, index)))] })), activeTab === 'video' && error.video && ((0, jsx_runtime_1.jsxs)("div", { className: "space-y-4", children: [(0, jsx_runtime_1.jsx)("p", { className: "text-sm text-gray-600", children: "Video recording of test execution:" }), (0, jsx_runtime_1.jsxs)("div", { className: "border border-gray-200 rounded-lg overflow-hidden", children: [(0, jsx_runtime_1.jsxs)("div", { className: "bg-gray-100 px-4 py-2 border-b border-gray-200 flex items-center justify-between", children: [(0, jsx_runtime_1.jsx)("span", { className: "text-sm font-medium text-gray-700", children: "Test Execution Video" }), (0, jsx_runtime_1.jsxs)("button", { onClick: () => window.electron.openPath(error.video), className: "text-sm text-blue-600 hover:text-blue-700 font-medium flex items-center gap-1", children: [(0, jsx_runtime_1.jsx)("svg", { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: (0, jsx_runtime_1.jsx)("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" }) }), "Open in Player"] })] }), (0, jsx_runtime_1.jsx)("div", { className: "p-4 bg-gray-50", children: (0, jsx_runtime_1.jsx)("div", { className: "aspect-video bg-gray-900 rounded flex items-center justify-center", children: (0, jsx_runtime_1.jsxs)("div", { className: "text-center text-gray-400", children: [(0, jsx_runtime_1.jsxs)("svg", { className: "w-16 h-16 mx-auto mb-3", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: [(0, jsx_runtime_1.jsx)("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" }), (0, jsx_runtime_1.jsx)("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M21 12a9 9 0 11-18 0 9 9 0 0118 0z" })] }), (0, jsx_runtime_1.jsxs)("p", { className: "text-sm", children: ["Video: ", error.video.split('\\').pop()] }), (0, jsx_runtime_1.jsx)("button", { onClick: () => window.electron.openPath(error.video), className: "mt-3 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors text-sm", children: "Play Video" })] }) }) })] })] })), activeTab === 'analysis' && error.analysis && ((0, jsx_runtime_1.jsxs)("div", { className: "space-y-6", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-center justify-between", children: [(0, jsx_runtime_1.jsx)("h3", { className: "text-lg font-semibold text-gray-900", children: "AI-Powered Error Analysis" }), getConfidenceBadge(error.analysis.confidence)] }), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("label", { className: "text-sm font-medium text-gray-700 mb-2 block", children: "Error Category" }), (0, jsx_runtime_1.jsx)("span", { className: `inline-flex px-3 py-1 rounded-full text-sm font-medium border ${getCategoryColor(error.analysis.category)}`, children: error.analysis.category.replace('_', ' ') })] }), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("label", { className: "text-sm font-medium text-gray-700 mb-2 block", children: "\uD83D\uDD0D Root Cause Analysis" }), (0, jsx_runtime_1.jsx)("div", { className: "bg-gray-50 border border-gray-200 rounded-lg p-4", children: (0, jsx_runtime_1.jsx)("p", { className: "text-gray-900", children: error.analysis.rootCause }) })] }), (0, jsx_runtime_1.jsxs)("div", { className: "grid md:grid-cols-2 gap-4", children: [(0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsxs)("label", { className: "text-sm font-medium text-gray-700 mb-2 block flex items-center gap-2", children: [(0, jsx_runtime_1.jsx)("svg", { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: (0, jsx_runtime_1.jsx)("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" }) }), "For Developer"] }), (0, jsx_runtime_1.jsx)("div", { className: "bg-blue-50 border border-blue-200 rounded-lg p-4", children: (0, jsx_runtime_1.jsx)("p", { className: "text-sm text-blue-900", children: error.analysis.suggestedFix.forDeveloper }) })] }), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsxs)("label", { className: "text-sm font-medium text-gray-700 mb-2 block flex items-center gap-2", children: [(0, jsx_runtime_1.jsx)("svg", { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: (0, jsx_runtime_1.jsx)("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" }) }), "For QA Tester"] }), (0, jsx_runtime_1.jsx)("div", { className: "bg-green-50 border border-green-200 rounded-lg p-4", children: (0, jsx_runtime_1.jsx)("p", { className: "text-sm text-green-900", children: error.analysis.suggestedFix.forQA }) })] })] }), (0, jsx_runtime_1.jsx)("div", { className: "bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 rounded-lg p-4", children: (0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-3", children: [(0, jsx_runtime_1.jsx)("div", { className: "bg-gradient-to-r from-purple-500 to-blue-500 rounded-full p-2", children: (0, jsx_runtime_1.jsx)("svg", { className: "w-5 h-5 text-white", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: (0, jsx_runtime_1.jsx)("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M13 10V3L4 14h7v7l9-11h-7z" }) }) }), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("p", { className: "text-sm font-medium text-gray-900", children: "AI-Powered Analysis" }), (0, jsx_runtime_1.jsx)("p", { className: "text-xs text-gray-600", children: "This analysis was generated using machine learning" })] })] }) })] }))] }), (0, jsx_runtime_1.jsxs)("div", { className: "bg-gray-50 border-t border-gray-200 px-6 py-4 flex items-center justify-between", children: [(0, jsx_runtime_1.jsx)("div", { className: "flex items-center gap-4", children: error.video && ((0, jsx_runtime_1.jsxs)("button", { onClick: () => window.electron.openPath(error.video), className: "flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors", children: [(0, jsx_runtime_1.jsx)("svg", { className: "w-4 h-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: (0, jsx_runtime_1.jsx)("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z" }) }), "Open Video Folder"] })) }), (0, jsx_runtime_1.jsx)("button", { onClick: onClose, className: "px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium", children: "Close" })] })] }) }));
};
exports.ErrorDetailModal = ErrorDetailModal;
//# sourceMappingURL=ErrorDetailModal.js.map